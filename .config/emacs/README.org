#+TITLE: My EMACS config
#+PROPERTY:  header-args :tangle init.el

* Table of content :TOC:
- [[#get-rid-of-annoying-startup-messages-scrollbar-tooltip-toolbar-etc][Get rid of annoying startup messages, scrollbar, tooltip, toolbar, etc..]]
- [[#improve-scrolling][Improve scrolling]]
- [[#improve-performance][Improve performance]]
- [[#quit-prompts-with-escape-key][Quit prompts with escape key]]
- [[#font-line-and-face][Font, line and face]]
- [[#enable-relative-line-numbers][Enable relative line numbers]]
- [[#initialize-package-sources-and-setup-use-package][Initialize package sources and setup use-package]]
- [[#auto-update-packages][Auto update packages]]
- [[#evil-mode][Evil mode]]
- [[#theme][Theme]]
- [[#modeline][Modeline]]
- [[#undo-tree][Undo tree]]
- [[#which-key][Which key]]
- [[#ivy-and-counsel][Ivy and counsel]]
- [[#m-x-great-again-get-rid-of-][M-x great again. Get rid of ^]]
- [[#remember-history][Remember history]]
- [[#better-way-of-defining-keybinding][Better way of defining keybinding]]
- [[#dashboard][Dashboard]]
- [[#teaching-emacs-to-keep-my-folders-clean][Teaching emacs to keep my folders clean]]
- [[#org][Org]]
  - [[#org-bullets][Org bullets]]
  - [[#org-tempo][Org tempo]]
  - [[#evil-org][Evil org]]
  - [[#automaticalloy-create-table-of-content][automaticalloy create table of content]]

* Get rid of annoying startup messages, scrollbar, tooltip, toolbar, etc..
#+begin_src emacs-lisp
(setq inhibit-startup-message t)
(setq initial-scratch-message nil)

(scroll-bar-mode -1) ; Disable visible scrollbar
(tool-bar-mode -1)   ; Disable the toolbar
(tooltip-mode -1)    ; Disable tooltips
(menu-bar-mode -1)   ; Disable the menu bar
(set-fringe-mode 10) ; Give some breathing room
#+end_src

* Improve scrolling
#+begin_src emacs-lisp
(setq scroll-conservatively 101)                    ;; value greater than 100 gets rid of half page jumping
(setq mouse-wheel-scroll-amount '(3 ((shift) . 3))) ;; how many lines at a time
(setq mouse-wheel-progressive-speed t)              ;; accelerate scrolling
(setq mouse-wheel-follow-mouse 't)                  ;; scroll window under mouse
#+end_src

* Improve performance
#+begin_src emacs-lisp
(setq company-lsp-cache-candidates 'auto)
(setq gc-cons-threshold 100000000)
(setq read-process-output-max (* 4096 4096))
(setq lsp-completion-provider :capf)
(setq lsp-idle-delay 0)
(setq lsp-enable-file-watchers nil)
(setq lsp-log-io nil)
#+end_src

* Quit prompts with escape key
#+begin_src emacs-lisp
(global-set-key (kbd "<escape>") 'keyboard-escape-quit)
#+end_src

* Font, line and face
#+begin_src emacs-lisp
(set-face-attribute 'default nil
  :font "FiraCode Nerd Font 14"
  :weight 'bold)

;; Makes keywords italics (working in emacsclient but not emacs)
(set-face-attribute 'font-lock-keyword-face nil
  :slant 'italic)

;; line spacing
;; (setq-default line-spacing 0.12)

#+end_src

* Enable relative line numbers
#+begin_src emacs-lisp
(column-number-mode)
(global-display-line-numbers-mode t)
(setq display-line-numbers-type 'relative)
#+end_src

* Initialize package sources and setup use-package
#+begin_src emacs-lisp
(require 'package)

(setq package-archives '(("melpa" . "https://melpa.org/packages/")
                         ("org" . "https://orgmode.org/elpa/")
                         ("elpa" . "https://elpa.gnu.org/packages/")))

(package-initialize)
(unless package-archive-contents
 (package-refresh-contents))

;; Initialize use-package on non-Linux platforms
(unless (package-installed-p 'use-package)
   (package-install 'use-package))

(require 'use-package)
(setq use-package-always-ensure t)
#+end_src

* Auto update packages
#+begin_src emacs-lisp
(use-package auto-package-update
  :custom
  (auto-package-update-interval 7)
  (auto-package-update-prompt-before-update nil)
  (auto-package-update-hide-results t)
  :config
  (auto-package-update-maybe)
  (auto-package-update-at-time "12:00"))
#+end_src

* Evil mode
#+begin_src emacs-lisp
(use-package evil
  :init
  (setq evil-want-integration t)
  (setq evil-want-keybinding nil)
  (setq evil-vsplit-window-right t)
  (setq evil-split-window-below t)
  (setq evil-want-C-u-scroll t)
  (setq evil-want-C-i-jump nil)
  :config
  (evil-mode 1)
  (define-key evil-normal-state-map (kbd "C-h") 'windmove-left)
  (define-key evil-normal-state-map (kbd "C-j") 'windmove-down)
  (define-key evil-normal-state-map (kbd "C-k") 'windmove-up)
  (define-key evil-normal-state-map (kbd "C-l") 'windmove-right)
  (define-key evil-normal-state-map (kbd "C-=") 'text-scale-increase)
  (define-key evil-normal-state-map (kbd "C--") 'text-scale-decrease))

(use-package evil-collection
	     :after evil
	     :ensure t
	     :config
	     (evil-collection-init))
#+end_src

* Theme
#+begin_src emacs-lisp
(use-package doom-themes
  :init (load-theme 'doom-one t)
  :config
      (setq doom-themes-enable-bold t
	        doom-themes-enable-italic t))
#+end_src

* Modeline
#+begin_src emacs-lisp
(use-package doom-modeline
             :ensure t
             :init (doom-modeline-mode 1)
             :custom ((doom-modeline-height 0.8)))
#+end_src

* Undo tree
#+begin_src emacs-lisp
(use-package undo-tree
  :init (global-undo-tree-mode t))
#+end_src

* Which key
#+begin_src emacs-lisp
(use-package which-key
  :init
  (setq which-key-side-window-location 'bottom
        which-key-sort-order #'which-key-key-order-alpha
        which-key-sort-uppercase-first nil
        which-key-add-column-padding 1
        which-key-max-display-columns nil
        which-key-min-display-lines 6
        which-key-side-window-slot -10
        which-key-side-window-max-height 0.25
        which-key-idle-delay 0.6
        which-key-max-description-length 25
        which-key-allow-imprecise-window-fit t
        which-key-separator " → " ))
(which-key-mode)
#+end_src

* Ivy and counsel
#+begin_src emacs-lisp
(use-package ivy
  :diminish
  :bind (:map ivy-minibuffer-map
         ("TAB" . ivy-alt-done)
         ("C-l" . ivy-alt-done)
         ("C-j" . ivy-next-line)
         ("C-k" . ivy-previous-line))
  :config
  (ivy-mode 1))

(use-package ivy-rich
  :init
  (ivy-rich-mode 1))

(use-package counsel
  :bind ("M-x" . counsel-M-x))

#+end_src

* M-x great again. Get rid of ^
#+begin_src emacs-lisp
(setq ivy-initial-inputs-alist nil)
#+end_src

* Remember history
#+begin_src emacs-lisp
(use-package smex)
(smex-initialize)
#+end_src

* Better way of defining keybinding
#+begin_src emacs-lisp
(use-package general
  :ensure t
  :config
  (general-evil-setup t))

(nvmap :prefix "SPC"
       "SPC"   '(find-file :which-key "Find file")
       "f r"   '(counsel-recentf :which-key "Recent files")
       "h r r" '((lambda () (interactive) (load-file "~/.config/emacs/init.el")) :which-key "Reload emacs config")

       ;; Buffers
       "b b"   '(ibuffer :which-key "Ibuffer")
       "b k"   '(kill-current-buffer :which-key "Kill current buffer")
       "b n"   '(next-buffer :which-key "Next buffer")
       "b p"   '(previous-buffer :which-key "Previous buffer")
       "b B"   '(ibuffer-list-buffers :which-key "Ibuffer list buffers")
       "b K"   '(kill-buffer :which-key "Kill buffer"))
#+end_src

* Dashboard
#+begin_src emacs-lisp
(use-package dashboard
  :ensure t
  :init
  (setq dashboard-set-heading-icons t)
  (setq dashboard-set-file-icons t)
  (setq dashboard-banner-logo-title "Emacs Is More Than A Text Editor!")
  (setq dashboard-startup-banner 'logo)
  (setq dashboard-center-content t) ;; set to 't' for centered content
  (setq dashboard-items '((recents . 5)
                          (agenda . 5 )
                          (bookmarks . 3)))
  :config
  (dashboard-setup-startup-hook)
  (dashboard-modify-heading-icons '((recents . "file-text")
			      (bookmarks . "book"))))
#+end_src

* Teaching emacs to keep my folders clean
#+begin_src emacs-lisp
(setq make-backup-files nil)
(setq create-lockfiles nil)
(setq projectile-known-projects-file (expand-file-name "tmp/projectile-bookmarks.eld" user-emacs-directory)
      lsp-session-file (expand-file-name "tmp/.lsp-session-v1" user-emacs-directory))
(setq user-emacs-directory (expand-file-name "~/.cache/emacs"))
(use-package no-littering)
;; auto-save-mode doesn't create the path automatically!
(make-directory (expand-file-name "tmp/auto-saves/" user-emacs-directory) t)
(setq auto-save-list-file-prefix (expand-file-name "tmp/auto-saves/sessions/" user-emacs-directory)
      auto-save-file-name-transforms `((".*" ,(expand-file-name "tmp/auto-saves/" user-emacs-directory) t)))
#+end_src

* Org
#+begin_src emacs-lisp
(defun efs/org-replace ()
  ;; Replace list hyphen with '➤'
  (font-lock-add-keywords 'org-mode
                          '(("^ *\\([-]\\) "
                             (0 (prog1 () (compose-region (match-beginning 1) (match-end 1) "➤")))))))

(use-package org
  :hook (org-mode . efs/org-replace)
   (setq org-mode t
         org-hide-emphasic-markers t)
  :config
  (setq org-ellipsis " ↴")
  (efs/org-replace))

(setq org-src-preserve-indentation nil
      org-src-tab-acts-natively t
      org-edit-src-content-indentation 0)

(setq org-src-fontify-natively t
    org-src-tab-acts-natively t
    org-confirm-babel-evaluate nil
    org-edit-src-content-indentation 0)
#+end_src

** Org bullets
#+begin_src emacs-lisp
(use-package org-bullets
  :after org
  :hook (org-mode . org-bullets-mode))
#+end_src

** Org tempo
#+begin_src emacs-lisp
(require 'org-tempo)
(add-to-list 'org-structure-template-alist '("" . "src"))
(add-to-list 'org-structure-template-alist '("sh" . "src bash"))
(add-to-list 'org-structure-template-alist '("cpp" . "src cpp :results output"))
(add-to-list 'org-structure-template-alist '("py" . "src python :results output"))
#+end_src

** Evil org
#+begin_src emacs-lisp
(use-package evil-org
  :ensure t
  :after (evil-org)
  :config
  (add-hook 'org-mode-hook 'evil-org-mode)
  (add-hook 'evil-org-mode-hook
	    (lambda ()
	      (evil-org-set-key-theme '(navigation
					insert
					textobjects
					additional
					calendar)))))
#+end_src

** Automaticalloy create table of content
#+begin_src emacs-lisp
(use-package toc-org
  :commands toc-org-enable
  :init (add-hook 'org-mode-hook 'toc-org-enable))
#+end_src
